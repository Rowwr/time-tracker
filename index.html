<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronos ¬∑ Time Tracker</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Outfit:wght@300;400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #131821;
            --bg-tertiary: #1a202e;
            --accent-primary: #00ff9d;
            --accent-glow: rgba(0, 255, 157, 0.3);
            --text-primary: #e8edf4;
            --text-secondary: #8b95a8;
            --border: #2a3447;
            --danger: #ff4466;
            --warning: #ffa726;
        }
        
        body {
            font-family: 'Outfit', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(0, 255, 157, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 136, 255, 0.03) 0%, transparent 50%);
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        header {
            margin-bottom: 3rem;
            text-align: center;
        }
        
        h1 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, var(--accent-primary), #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 300;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }
        
        .section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-primary), transparent);
            opacity: 0.3;
        }
        
        .section-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 4px;
            background: var(--accent-primary);
            border-radius: 50%;
        }
        
        .task-input-group {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }
        
        input[type="text"] {
            flex: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.875rem 1rem;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.938rem;
            transition: all 0.2s ease;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }
        
        input[type="text"]::placeholder {
            color: var(--text-secondary);
        }
        
        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .btn-primary {
            background: var(--accent-primary);
            color: var(--bg-primary);
            box-shadow: 0 0 20px var(--accent-glow);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 30px var(--accent-glow);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: var(--bg-primary);
            border-color: var(--accent-primary);
        }
        
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .task-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
        }
        
        .task-item.active {
            background: rgba(0, 255, 157, 0.05);
            border-color: var(--accent-primary);
            box-shadow: 0 0 30px rgba(0, 255, 157, 0.15);
        }
        
        .task-name {
            flex: 1;
            font-size: 1rem;
            font-weight: 400;
            color: var(--text-primary);
        }
        
        .task-timer {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-primary);
            min-width: 100px;
            text-align: right;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .task-item.active .task-timer {
            opacity: 1;
        }
        
        .task-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .icon-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
        }
        
        .icon-btn.play {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            box-shadow: 0 0 15px var(--accent-glow);
        }
        
        .icon-btn.play:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px var(--accent-glow);
        }
        
        .icon-btn.stop {
            background: var(--danger);
            border-color: var(--danger);
            box-shadow: 0 0 15px rgba(255, 68, 102, 0.3);
        }
        
        .icon-btn.delete:hover {
            background: var(--danger);
            border-color: var(--danger);
            color: white;
        }
        
        .history-list {
            max-height: 400px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .history-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .history-list::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }
        
        .history-list::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }
        
        .history-list::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }
        
        .history-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 1rem;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .history-task {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .history-date {
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
        }
        
        .history-duration {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--accent-primary);
            padding: 0.375rem 0.75rem;
            background: rgba(0, 255, 157, 0.1);
            border-radius: 6px;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
        
        .export-section {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .task-item.active .task-timer {
            animation: pulse 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CHRONOS</h1>
            <div class="subtitle">Time Tracking System</div>
        </header>
        
        <!-- Task Menu -->
        <div class="section">
            <div class="section-title">Task Menu</div>
            <div class="task-input-group">
                <input type="text" id="taskInput" placeholder="Enter new task name...">
                <button class="btn btn-primary" onclick="addTask()">Create Task</button>
            </div>
            <div class="task-list" id="taskList">
                <div class="empty-state">
                    <div class="empty-state-icon">‚è±Ô∏è</div>
                    <p>No tasks yet. Create your first task to get started.</p>
                </div>
            </div>
        </div>
        
        <!-- Recent Activity -->
        <div class="section">
            <div class="section-title">Recent Activity <span style="font-weight: 300; opacity: 0.6;">(Last 5 Sessions)</span></div>
            <div class="history-list" id="recentActivity">
                <div class="empty-state">
                    <div class="empty-state-icon">üìä</div>
                    <p>No activity logged yet. Start tracking time to see your sessions here.</p>
                </div>
            </div>
        </div>
        
        <!-- Full History & Export -->
        <div class="section">
            <div class="section-title">Session History</div>
            <div class="history-list" id="historyList">
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <p>All your time tracking sessions will appear here.</p>
                </div>
            </div>
            <div class="export-section">
                <button class="btn btn-secondary" onclick="exportToExcel()">
                    <span style="margin-right: 0.5rem;">üì•</span>
                    Export to Excel
                </button>
            </div>
        </div>
    </div>

    <script>
        // Storage keys
        const STORAGE_KEYS = {
            TASKS: 'chronos_tasks',
            HISTORY: 'chronos_history',
            ACTIVE_TASK: 'chronos_active_task'
        };
        
        // State
        let tasks = [];
        let history = [];
        let activeTask = null;
        let timerInterval = null;
        
        // Initialize app
        function init() {
            loadData();
            renderTasks();
            renderHistory();
            renderRecentActivity();
            
            // Resume active timer if exists
            if (activeTask) {
                startTimer(activeTask.id, true);
            }
        }
        
        // Load data from persistent storage
        function loadData() {
            try {
                const tasksData = localStorage.getItem(STORAGE_KEYS.TASKS);
                const historyData = localStorage.getItem(STORAGE_KEYS.HISTORY);
                const activeData = localStorage.getItem(STORAGE_KEYS.ACTIVE_TASK);
                
                tasks = tasksData ? JSON.parse(tasksData) : [];
                history = historyData ? JSON.parse(historyData) : [];
                activeTask = activeData ? JSON.parse(activeData) : null;
            } catch (error) {
                // Storage not available or corrupted
                console.error('Failed to load data:', error);
                tasks = [];
                history = [];
                activeTask = null;
            }
        }
        
        // Save data to persistent storage
        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEYS.TASKS, JSON.stringify(tasks));
                localStorage.setItem(STORAGE_KEYS.HISTORY, JSON.stringify(history));
                localStorage.setItem(STORAGE_KEYS.ACTIVE_TASK, JSON.stringify(activeTask));
            } catch (error) {
                console.error('Failed to save data:', error);
                alert('Failed to save data. Your browser storage may be full.');
            }
        }
        
        // Add new task
        function addTask() {
            const input = document.getElementById('taskInput');
            const taskName = input.value.trim();
            
            if (!taskName) return;
            
            const task = {
                id: Date.now().toString(),
                name: taskName,
                createdAt: new Date().toISOString()
            };
            
            tasks.push(task);
            saveData();
            
            input.value = '';
            renderTasks();
        }
        
        // Delete task
        function deleteTask(taskId) {
            if (activeTask && activeTask.id === taskId) {
                stopTimer(taskId);
            }
            
            tasks = tasks.filter(t => t.id !== taskId);
            saveData();
            renderTasks();
        }
        
        // Start timer
        function startTimer(taskId, resume = false) {
            // Stop any active timer first
            if (activeTask && activeTask.id !== taskId) {
                stopTimer(activeTask.id);
            }
            
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const now = new Date();
            
            if (!resume) {
                activeTask = {
                    id: taskId,
                    name: task.name,
                    startTime: now.toISOString(),
                    elapsed: 0
                };
            }
            
            saveData();
            
            // Clear any existing interval
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            // Start new interval
            timerInterval = setInterval(() => {
                updateTimerDisplay(taskId);
            }, 1000);
            
            renderTasks();
            updateTimerDisplay(taskId);
        }
        
        // Stop timer
        function stopTimer(taskId) {
            if (!activeTask || activeTask.id !== taskId) return;
            
            clearInterval(timerInterval);
            timerInterval = null;
            
            const endTime = new Date();
            const startTime = new Date(activeTask.startTime);
            const duration = Math.floor((endTime - startTime) / 1000); // in seconds
            
            // Create history entry
            const historyEntry = {
                id: Date.now().toString(),
                taskName: activeTask.name,
                startTime: activeTask.startTime,
                endTime: endTime.toISOString(),
                duration: duration
            };
            
            history.unshift(historyEntry); // Add to beginning
            activeTask = null;
            
            saveData();
            
            renderTasks();
            renderHistory();
            renderRecentActivity();
        }
        
        // Update timer display
        function updateTimerDisplay(taskId) {
            if (!activeTask || activeTask.id !== taskId) return;
            
            const startTime = new Date(activeTask.startTime);
            const now = new Date();
            const elapsed = Math.floor((now - startTime) / 1000);
            
            const hours = Math.floor(elapsed / 3600);
            const minutes = Math.floor((elapsed % 3600) / 60);
            const seconds = elapsed % 60;
            
            const display = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
            
            const timerElement = document.querySelector(`[data-task-id="${taskId}"] .task-timer`);
            if (timerElement) {
                timerElement.textContent = display;
            }
        }
        
        // Format duration
        function formatDuration(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            return `${pad(hours)}:${pad(minutes)}:${pad(secs)}`;
        }
        
        // Pad numbers
        function pad(num) {
            return num.toString().padStart(2, '0');
        }
        
        // Format date
        function formatDate(isoString) {
            const date = new Date(isoString);
            return date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Render tasks
        function renderTasks() {
            const taskList = document.getElementById('taskList');
            
            if (tasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚è±Ô∏è</div>
                        <p>No tasks yet. Create your first task to get started.</p>
                    </div>
                `;
                return;
            }
            
            taskList.innerHTML = tasks.map(task => {
                const isActive = activeTask && activeTask.id === task.id;
                
                return `
                    <div class="task-item ${isActive ? 'active' : ''}" data-task-id="${task.id}">
                        <div class="task-name">${escapeHtml(task.name)}</div>
                        <div class="task-timer">00:00:00</div>
                        <div class="task-controls">
                            ${isActive ? `
                                <button class="icon-btn stop" onclick="stopTimer('${task.id}')" title="Stop">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                                        <rect x="6" y="6" width="12" height="12" rx="2"/>
                                    </svg>
                                </button>
                            ` : `
                                <button class="icon-btn play" onclick="startTimer('${task.id}')" title="Play">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#0a0e1a">
                                        <path d="M8 5v14l11-7z"/>
                                    </svg>
                                </button>
                            `}
                            <button class="icon-btn delete" onclick="deleteTask('${task.id}')" title="Delete">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Update active timer if exists
            if (activeTask) {
                updateTimerDisplay(activeTask.id);
            }
        }
        
        // Render recent activity (last 5)
        function renderRecentActivity() {
            const container = document.getElementById('recentActivity');
            const recent = history.slice(0, 5);
            
            if (recent.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <p>No activity logged yet. Start tracking time to see your sessions here.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recent.map(entry => `
                <div class="history-item">
                    <div class="history-task">${escapeHtml(entry.taskName)}</div>
                    <div class="history-date">${formatDate(entry.startTime)}</div>
                    <div class="history-duration">${formatDuration(entry.duration)}</div>
                </div>
            `).join('');
        }
        
        // Render full history
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            
            if (history.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>All your time tracking sessions will appear here.</p>
                    </div>
                `;
                return;
            }
            
            historyList.innerHTML = history.map(entry => `
                <div class="history-item">
                    <div class="history-task">${escapeHtml(entry.taskName)}</div>
                    <div class="history-date">${formatDate(entry.startTime)}</div>
                    <div class="history-duration">${formatDuration(entry.duration)}</div>
                </div>
            `).join('');
        }
        
        // Export to Excel (CSV format)
        function exportToExcel() {
            if (history.length === 0) {
                alert('No data to export. Start tracking time first!');
                return;
            }
            
            // Create CSV content
            let csv = 'Task Name,Start Time,End Time,Total Duration (HH:MM:SS)\n';
            
            history.forEach(entry => {
                const taskName = `"${entry.taskName.replace(/"/g, '""')}"`;
                const startTime = new Date(entry.startTime).toLocaleString();
                const endTime = new Date(entry.endTime).toLocaleString();
                const duration = formatDuration(entry.duration);
                
                csv += `${taskName},${startTime},${endTime},${duration}\n`;
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const fileName = `chronos-export-${new Date().toISOString().split('T')[0]}.csv`;
            
            link.setAttribute('href', url);
            link.setAttribute('download', fileName);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Handle Enter key in input
        document.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('taskInput');
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addTask();
                }
            });
        });
        
        // Initialize on load
        init();
    </script>
</body>
</html>
